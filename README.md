# pHTML Tape [<img src="https://phtml.io/logo.svg" alt="pHTML" width="90" height="90" align="right">][pHTML]

[![NPM Version][npm-img]][npm-url]
[![Build Status][cli-img]][cli-url]
[![Gitter Chat][git-img]][git-url]

[pHTML Tape] lets you quickly test [pHTML] plugins.

1. Install this dependency to your project:
   ```sh
   npm install phtml-tape --save-dev
   ```

2. Add the `phtml-tape` task to your `package.json`:
   ```json
   {
      "scripts": {
        "test": "phtml-tape"
      }
   }
   ```

3. Add tests to your `.tape.js` file:
   ```js
   module.exports = {
     'basic': {
       message: 'supports basic usage'
     }
   };
   ```

That’s it! Empty tests will be auto-generated.

```sh
npm test
```

## Options

Options may be passed through `package.json` using `phtmlConfig`:

```json
{
  "phtmlConfig": {
    "plugin": "path/to/plugin.js",
    "config": "path/to/.tape.js",
    "fixtures": "path/to/htmldir"
  }
}
```

Options may be passed through arguments:

```sh
phtml-tape --plugin=path/to/plugin.js --config=path/to/.tape.js
```

## Test Options

### message

The message provided to the console to identify the test being run.

```js
{
  'some-test': {
    message: 'supports some test usage'
  }
}
```

### options

The options passed into the pHTML plugin for the test.

```js
{
  'some-test': {
    options: {
      someOption: true,
      anotherOption: 5,
      etc: 'etc'
    }
  }
}
```

### processOptions

The process options passed into pHTML for the test. Read the
[pHTML documentation](https://jonathantneal.github.io/phtml/Result.html) for
more details.

```js
{
  'some-test': {
    processOptions: {
      map: {
        inline: true,
        sourcesContent: true
      }
    }
  }
}
```

### warnings

Either the number of warnings expected to be generated by the test, or an
object used to match warnings given by the test.

```js
{
  'some-test': {
    warnings: 3
  }
}
```

```js
{
  'some-test': {
    warnings: {
      text: /should warn/
    }
  }
}
```

### error

An object used to match errors thrown by the test.

```js
{
  'some-test': {
    errors: {
      message: 'You should not have done that'
    }
  }
}
```

In that example, the error expects a field of `message` to be the string
`You should not have done that`. In order that errors can be inspecific,
regular expressions may also be used, so that something like
`message: /^You should not have done/` would also match
`You should not have done this`.

### source

The location of the source HTML file, relative to the `fixtures` directory. This
file is passed through the pHTML plugin.

```js
{
  'some-test': {
    source: 'alterate-source.html'
  }
}
```

In that example, a `some-test` field would automatically populate the
`source` as `some-test.html` unless it was overridden. In order that multiple
tests may use the same source file, a `some-test:modifier` field would still
populate the `source` as `some-test.html`.

### expect

The location of the expected HTML file, relative to the `fixtures` directory.
This file is represents the expected HTML result of `source` after being passed
through the pHTML plugin.

```js
{
  'some-test': {
    expect: 'alterate-expect.html'
  }
}
```

In that example, a `some-test` field would automatically populate the
`expect` as `some-test.expect.html` unless it was overridden. In order that
multiple tests may use the same source file, a `some-test:modifier` field would
still populate the `source` as `some-test.html`, but alter the `expect` to be
`some-test.modifier.expect.html`.

### result

The location of the resulting HTML file, relative to the `fixtures` directory.
This file is the HTML result of `source` after being passed through the pHTML
plugin.

```js
{
  'some-test': {
    result: 'alterate-result.html'
  }
}
```

In that example, a `some-test` field would automatically populate the
`result` as `some-test.result.html` unless it was overridden. In order that
multiple tests may use the same source file, a `some-test:modifier` field would
still populate the `source` as `some-test.html`, but alter the `result` to be
`some-test.modifier.result.html`.

### before

A function to be run before the particular test. This is helpful for generating
variables, content, or files that will be used by the plugin.

```js
{
  'some-test': {
    before: () => {
      /* do something before the plugin runs */
    }
  }
}
```

### after

A function to be run after the particular test. This is helpful for cleaning up
variables, content, or files that were used by the plugin.

```js
{
  'some-test': {
    after: () => {
      /* do something after the plugin runs */
    }
  }
}
```

### plugin

A plugin or array of plugins that will specifying alternative plugin

```js
{
  'some-test': {
    plugin: () => require('phtml')(
      require('some-plugin-that-runs-before'),
      require('.'),
      require('some-plugin-that-runs-after')
    )
  }
}
```

## CLI Options

Options can be passed into the `phtml-tape` function or defined in
`package.json` using the `phtmlConfig` property.

### plugin

The path to the plugin being tested.

```bash
phtml-tape --plugin=path/to/plugin.js
```

```json
{
  "phtmlConfig": {
    "plugin": "path/to/plugin.js"
  }
}
```

By default, `plugin` is the resolved file from the current working directory.

### config

The path to the configuration file used to run tests.

```bash
phtml-tape --config=path/to/config.js
```

```json
{
  "phtmlConfig": {
    "config": "path/to/config.js"
  }
}
```

By default, [pHTML Tape] will try to use the file defined by `config`, or
the `config` directory’s `phtml-tape.config.js` or `.tape.js` file. By
default, `config` is the current working directory.

### fixtures

The path to the fixtures used by tests.

```bash
phtml-tape --fixtures=path/to/tests
```

```json
{
  "phtmlConfig": {
    "fixtures": "path/to/tests"
  }
}
```

[npm-img]: https://img.shields.io/npm/v/phtml-tape.svg
[npm-url]: https://www.npmjs.com/package/phtml-tape
[cli-img]: https://img.shields.io/travis/phtmlorg/phtml-tape.svg
[cli-url]: https://travis-ci.org/phtmlorg/phtml-tape
[git-img]: https://img.shields.io/badge/chat-gitter-blue.svg
[git-url]: https://gitter.im/phtml/phtml

[pHTML]: https://github.com/phtml/phtml
[pHTML Tape]: https://github.com/phtmlorg/phtml-tape
